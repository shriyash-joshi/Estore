jQuery(function(_){var o=_("#woocommerce-order-items"),n=!1,i={handle_events:function(){o.on("click","button.configure_bundle",{action:"configure"},this.clicked_edit_button).on("click","button.edit_bundle",{action:"edit"},this.clicked_edit_button)},clicked_edit_button:function(e){var t=_.WCBackboneModal.View.extend({addButton:i.clicked_done_button}),o=_(this).closest("tr.item").attr("data-order_item_id");return n=new t({target:"wc-modal-edit-bundle",string:{action:"configure"===e.data.action?wc_bundles_admin_order_params.i18n_configure:wc_bundles_admin_order_params.i18n_edit,item_id:o}}),i.populate_form(),!1},clicked_done_button:function(t){i.block(n.$el.find(".wc-backbone-modal-content"));var e=_.extend({},i.get_taxable_address(),{action:"woocommerce_edit_bundle_in_order",item_id:n._string.item_id,fields:n.$el.find("input, select, textarea").serialize(),dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:wc_bundles_admin_order_params.edit_bundle_nonce});_.post(woocommerce_admin_meta_boxes.ajax_url,e,function(e){e.result&&"success"===e.result?(o.find(".inside").empty(),o.find(".inside").append(e.html),"yes"===wc_bundles_admin_order_params.is_wc_version_gte_3_4?o.trigger("wc_order_items_reloaded"):(i.core.init_tiptip(),i.core.stupidtable.init()),"yes"===wc_bundles_admin_order_params.is_wc_version_gte_3_6&&e.notes_html&&(_("ul.order_notes").empty(),_("ul.order_notes").append(_(e.notes_html).find("li"))),i.unblock(n.$el.find(".wc-backbone-modal-content")),i.block(o,{fadeIn:0}),setTimeout(function(){i.unblock(o)},250),n.closeButton(t)):(window.alert(e.error?e.error:wc_bundles_admin_order_params.i18n_validation_error),i.unblock(n.$el.find(".wc-backbone-modal-content")))})},populate_form:function(){i.block(n.$el.find(".wc-backbone-modal-content"));var e={action:"woocommerce_configure_bundle_order_item",item_id:n._string.item_id,dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:wc_bundles_admin_order_params.edit_bundle_nonce};_.post(woocommerce_admin_meta_boxes.ajax_url,e,function(e){e.result&&"success"===e.result?(n.$el.find("form").html(e.html),i.unblock(n.$el.find(".wc-backbone-modal-content"))):(window.alert(wc_bundles_admin_order_params.i18n_form_error),i.unblock(n.$el.find(".wc-backbone-modal-content")),n.$el.find(".modal-close").trigger("click"))})},get_taxable_address:function(){var e="",t="",o="",n="";return"shipping"===woocommerce_admin_meta_boxes.tax_based_on&&(e=_("#_shipping_country").val(),t=_("#_shipping_state").val(),o=_("#_shipping_postcode").val(),n=_("#_shipping_city").val()),"billing"!==woocommerce_admin_meta_boxes.tax_based_on&&e||(e=_("#_billing_country").val(),t=_("#_billing_state").val(),o=_("#_billing_postcode").val(),n=_("#_billing_city").val()),{country:e,state:t,postcode:o,city:n}},block:function(e,t){var o=_.extend({},{message:null,overlayCSS:{background:"#fff",opacity:.6}},t||{});e.block(o)},unblock:function(e){e.unblock()}};"no"===wc_bundles_admin_order_params.is_wc_version_gte_3_4&&(i.core={init_tiptip:function(){_("#tiptip_holder").removeAttr("style"),_("#tiptip_arrow").removeAttr("style"),_(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},stupidtable:{init:function(){_(".woocommerce_order_items").stupidtable(),_(".woocommerce_order_items").on("aftertablesort",this.add_arrows)},add_arrows:function(e,t){var o=_(this).find("th"),n="asc"===t.direction?"&uarr;":"&darr;",i=t.column;o.find(".wc-arrow").remove(),o.eq(i).append('<span class="wc-arrow">'+n+"</span>")}}}),i.handle_events()});