!function(o){if("undefined"==typeof wc_price_based_country_ajax_geo_params)return;var n={xhr:!1,get_product_ids:function(){var i=[],r=null;return o("span.wcpbc-price.loading").each(function(){if(void 0===(r=o(this).data("productId"))){var e=o(this).attr("class").match(/wcpbc-price-\d+/);null!=e&&0<e.length&&(r=parseInt(e[0].replace("wcpbc-price-","")))}r&&void 0!==r&&i.push(r)}),0<o(".variations_form").length&&o(".variations_form").each(function(){var e=o(this).data("product_variations");null!=e&&o.each(e,function(e,r){void 0!==r.variation_id&&i.push(r.variation_id)})}),o(document.body).trigger("wc_price_based_country_get_product_ids",[i]),i.sort(),i},get_areas:function(){var t={};return o(".wc-price-based-country-refresh-area:not(.refreshed)").each(function(e,r){var i=o(r).data("area"),a=o(r).data("id"),c=o(r).data("options");void 0!==i&&void 0!==a&&void 0!==c&&(void 0===t[i]&&(t[i]={}),t[i][a]=c)}),t},refresh_product_price:function(t){var i;o.each(t,function(e,r){void 0!==(i=o("<div>"+r.price_html+"</div>").find(".wcpbc-price.wcpbc-price-"+r.id+":first"))&&o(".wcpbc-price.wcpbc-price-"+r.id).html(i.html()).removeClass("loading")}),0<o(".variations_form").length&&o(".variations_form").each(function(){var a=o(this).data("product_variations"),c=o(this);null!=a&&(o.each(a,function(e,r){if(void 0!==t[r.variation_id]){var i=o(r.price_html);a[e].display_price=t[r.variation_id].display_price,a[e].display_regular_price=t[r.variation_id].display_regular_price,0<i.length?i.hasClass("price")?i.first().html(t[r.variation_id].price_html):i=o(t[r.variation_id].price_html):o("body").hasClass("single-product")||(i=n.compatibility.variation_price_html(i,c,t[r.variation_id].price_html)),0<i.length&&(i.find(".wcpbc-price").css("visibility",""),i.find(".wcpbc-price").removeClass("loading"),i=o("<div></div>").append(i),a[e].price_html=i.html())}}),o(this).data("product_variations",a))}),o(document.body).trigger("wc_price_based_country_set_product_price",[t]),o(".wcpbc-price").css("visibility",""),o(".wcpbc-price").css("display",""),o(".wcpbc-price").removeClass("loading")},refresh_areas:function(e){o.each(e,function(e,r){var i='.wc-price-based-country-refresh-area[data-id="'+r.id+'"][data-area="'+r.area+'"]',a=o(r.content).filter('.wc-price-based-country-refresh-area[data-area="'+r.area+'"]').html();o(i).html(a).addClass("refreshed")})},refresh_currency_settings:function(e){if("undefined"!=typeof woocommerce_price_slider_params&&"undefined"!=typeof accounting){var r=o(".price_slider_amount #min_price").data("min"),i=o(".price_slider_amount #max_price").data("max");o(".price_slider_amount span.from").html(accounting.formatMoney(r,{symbol:e.symbol,decimal:e.decimal_sep,thousand:e.thousand_sep,precision:woocommerce_price_slider_params.currency_format_num_decimals,format:e.format})),o(".price_slider_amount span.to").html(accounting.formatMoney(i,{symbol:e.symbol,decimal:e.decimal_sep,thousand:e.thousand_sep,precision:woocommerce_price_slider_params.currency_format_num_decimals,format:e.format})),woocommerce_price_slider_params.currency_format_symbol=e.symbol,woocommerce_price_slider_params.currency_format_decimal_sep=e.decimal_sep,woocommerce_price_slider_params.currency_format_thousand_sep=e.thousand_sep,woocommerce_price_slider_params.currency_format=e.format}o(document.body).trigger("wc_price_based_country_set_currency_params",[e])},compatibility:{variation_price_html:function(e,r,i){return e.length<=0&&r.hasClass("wvs-archive-variation-wrapper")&&(e=o("<span></span>").append(i)),e},bind:function(){0<o(".shop-container .products").length&&o(".shop-container .products").on("append.infiniteScroll",n.geolocate_customer)}},geolocate_customer:function(){n.xhr&&n.xhr.abort();var e={ids:n.get_product_ids(),areas:n.get_areas(),is_single:o("body").hasClass("single")?"1":"0"};0===e.ids.length&&o.isEmptyObject(e.areas)&&0===o(".wcpbc-content:not(.refreshed)").length||(n.xhr=o.ajax({url:wc_price_based_country_ajax_geo_params.wc_ajax_url.toString().replace("%%endpoint%%","wcpbc_get_location"),data:e,type:"POST",success:function(e){n.refresh_product_price(e.products),n.refresh_areas(e.areas),n.refresh_currency_settings(e.currency_params),o(document.body).trigger("wc_price_based_country_after_ajax_geolocation",[e.zone_id])},error:function(){o(".wcpbc-price").css("visibility",""),o(".wcpbc-price").css("display",""),o(".wcpbc-price").removeClass("loading")},complete:function(){n.xhr=!1}}))},init:function(){this.geolocate_customer(),o(document).ajaxComplete(function(e,r,i){0==o("body").find(".wcpbc-price.loading").length||0<i.url.indexOf("wcpbc_get_location")||0<i.url.indexOf("get_refreshed_fragments")||void 0!==r.responseText&&0<r.responseText.indexOf("wcpbc-price")&&n.geolocate_customer()}),o(document.body).on("wc_price_based_country_ajax_geolocation",n.geolocate_customer),this.compatibility.bind()}};n.init()}(jQuery);